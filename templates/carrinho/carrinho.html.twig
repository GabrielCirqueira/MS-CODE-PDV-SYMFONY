{% extends 'layout.html.twig' %}

{% block body %}
<div class="container cart-container mt-5">
    <h1 class="titulo page-title">Carrinho</h1>

    <div class="row summary-cards my-4">
        <div class="col-md-4">
            <div class="card text-center card-summary">
                <div class="card-body card-summary-body">
                    <div class="flex summary-flex">Total 
                        <div><i class="fas fa-dollar-sign"></i></div>
                    </div>
                    <div class="summary-dash">-</div>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card text-center card-summary">
                <div class="card-body card-summary-body">
                    <div class="flex summary-flex">Status 
                        <div><i class="fas fa-tag"></i></div>
                    </div>
                    <div class="summary-dash">-</div>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card text-center card-summary">
                <div class="card-body card-summary-body">
                    <div class="flex summary-flex">Criação 
                        <div><i class="fas fa-calendar"></i></div>
                    </div>
                    <div class="summary-dash">-</div>
                </div>
            </div>
        </div>
    </div>

    <div class="card mb-4 client-search-card">
        <div class="card-body client-search-body">
            <h5 class="client-label">Cliente*</h5>
            <div class="input-group client-input-group">
                <input type="text" class="form-control client-input" id="client-search-input" placeholder="Buscar cliente por nome, CPF ou CNPJ...">
                <button class="btn color-btn search-button">Procurar Cliente</button>
            </div>
            <ul class="list-group" id="client-suggestions" style="display: none; position: absolute; z-index: 1000; width: 100%;">
            </ul>
        </div>
    </div>

    <table class="table table-bordered cart-table">
        <thead class="table-light cart-table-head">
            <tr>
                <th class="text-center align-middle header-cell">Nome</th>
                <th class="text-center align-middle header-cell">Categoria</th>
                <th class="text-center align-middle header-cell">Estoque</th>
                <th class="text-center align-middle header-cell">Valor/Un.</th>
                <th class="text-center align-middle header-cell">Quantidade</th>
                <th class="text-center align-middle header-cell">Total</th>
                <th class="text-center align-middle header-cell"></th>
            </tr>
        </thead>
        <tbody class="cart-table-body">
            <tr>
                <td class="text-center align-middle item-cell">teste 1</td>
                <td class="text-center align-middle item-cell">Categoria 1</td>
                <td class="text-center align-middle item-cell">50</td>
                <td class="text-center align-middle item-cell">R$ 10,00</td>
                <td class="text-center align-middle item-cell">
                    <div class="quantity-wrapper refres">
                        <input type="number" class="quantity-input" name="" id="">
                    </div>
                </td>
                <td class="text-center align-middle item-cell">R$ 20,00</td>
                <td class="text-center align-middle item-cell">
                    <div><img class="icon-size-table delete-icon" src="../imgs/lixeira-de-reciclagem (1).png" alt=""></div>
                </td>
            </tr>
        </tbody>
    </table>
</div>


<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(document).ready(function () {
        const $clientSearchInput = $('#client-search-input');
        const $clientSuggestions = $('#client-suggestions');

        $clientSearchInput.on('input', function () {
            const query = $(this).val().trim();
            if (query.length < 1) {
                $clientSuggestions.hide();
                return;
            }

            $.ajax({
                url: 'http://localhost:8000/api/clientes',
                method: 'GET',
                dataType: 'json',
                success: function (data) {
                    const filteredClients = data.filter(client => client.nome.toLowerCase().includes(query.toLowerCase()));
                    
                    $clientSuggestions.empty();

                    if (filteredClients.length) {
                        filteredClients.forEach(client => {
                            $clientSuggestions.append(
                                `<li class="list-group-item list-group-item-action" data-id="${client.id}">${client.nome}</li>`
                            );
                        });
                        $clientSuggestions.show();
                    } else {
                        $clientSuggestions.hide();
                    }
                },
                error: function () {
                    console.error("Erro ao buscar clientes");
                }
            });
        });

        $clientSuggestions.on('click', '.list-group-item', function () {
            const selectedClientName = $(this).text();
            $clientSearchInput.val(selectedClientName);
            $clientSuggestions.hide();
        });

        $(document).on('click', function (e) {
            if (!$(e.target).closest('.client-search-body').length) {
                $clientSuggestions.hide();
            }
        });
    });
</script>
{% endblock %}
