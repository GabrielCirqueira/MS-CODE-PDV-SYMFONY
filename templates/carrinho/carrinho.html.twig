{% extends 'layout.html.twig' %}

{% block body %}
<div class="container cart-container mt-5">
    <h1 class="titulo page-title">Carrinho</h1>

    <div class="row summary-cards my-4">
        <div class="col-md-4">
            <div class="card text-center card-summary">
                <div class="card-body card-summary-body">
                    <div class="flex summary-flex">Total
                        <div><i class="fas fa-dollar-sign"></i></div>
                    </div>
                    <div class="summary-dash">-</div>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card text-center card-summary">
                <div class="card-body card-summary-body">
                    <div class="flex summary-flex">Status
                        <div><i class="fas fa-tag"></i></div>
                    </div>
                    <div class="summary-dash">-</div>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card text-center card-summary">
                <div class="card-body card-summary-body">
                    <div class="flex summary-flex">Criação
                        <div><i class="fas fa-calendar"></i></div>
                    </div>
                    <div class="summary-dash">-</div>
                </div>
            </div>
        </div>
    </div>

    <div class="card mb-4 client-search-card">
        <div class="card-body client-search-body">
            <h5 class="client-label">Cliente*</h5>
            <div class="input-group client-input-group">
                <input type="text" class="form-control client-input" id="client-search-input"
                    placeholder="Buscar cliente por nome, CPF ou CNPJ...">
                <button id="button-procurar-cliente" class="btn color-btn search-button">Procurar Cliente</button>
            </div>
            <ul class="list-group" id="client-suggestions"
                style="display: none; position: absolute; z-index: 1000; width: 100%;">
            </ul>
        </div>
    </div>

    <div class="card mb-4 product-search-card">
        <div class="card-body product-search-body">
            <h5 class="product-label">Produto*</h5>
            <div class="input-group product-input-group">
                <input disabled type="text" class="form-control product-input" id="product-search-input"
                    placeholder="Buscar produto por nome, código ou categoria...">
                <button id="button-inserir-produto" class="btn color-btn search-button">Inserir Produto</button>
            </div>
            <ul class="list-group" id="product-suggestions"
                style="display: none; position: absolute; z-index: 1000; width: 100%;"></ul>
        </div>
    </div>

    <div class="card mb-4 cart-table-card">
        <div class="card-body">
            <table class="table">
                <thead class="table-light cart-table-head">
                    <tr>
                        <th class="text-center align-middle header-cell">Nome</th>
                        <th class="text-center align-middle header-cell">Categoria</th>
                        <th class="text-center align-middle header-cell">Estoque</th>
                        <th class="text-center align-middle header-cell">Valor/Un.</th>
                        <th class="text-center align-middle header-cell">Quantidade</th>
                        <th class="text-center align-middle header-cell">Total</th>
                    </tr>
                </thead>
                <tbody class="cart-table-body">
                    <tr>
                        <td colspan="6" class="text-center" >Por favor, selecione um cliente!</td>
                        {# <td class="text-center align-middle item-cell">teste 1</td>
                        <td class="text-center align-middle item-cell">Categoria 1</td>
                        <td class="text-center align-middle item-cell">50</td>
                        <td class="text-center align-middle item-cell">R$ 10,00</td>
                        <td class="text-center align-middle item-cell">
                        <input type="number" value="1" class="quantity-input" name="" id="">
                        </td>
                        <td class="text-center align-middle item-cell">R$ 20,00</td> #}
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

<script>
    $(document).ready(function () {

        function configurarBusca(botaoId,entradaId, sugestoesId, apiUrl) {
            const $campoEntrada = $(`#${entradaId}`);
            const $listaSugestoes = $(`#${sugestoesId}`);
            const $butao = $(`#${botaoId}`);

            $campoEntrada.on('input', function () {
                const termo = $campoEntrada.val().trim();

                if (termo.length < 1) {
                    $listaSugestoes.hide();
                    return;
                }

                $.ajax({
                    url: apiUrl,
                    method: 'GET',
                    success: function (dados) {
                        $listaSugestoes.empty();
                        const resultados = dados.filter(function (item) {
                            return item.nome.toLowerCase().includes(termo.toLowerCase());
                        });

                        if (resultados.length > 0) {
                            resultados.forEach(function (item) {
                                $listaSugestoes.append(`<li class="list-group-item" data-id="${item.id}">${item.nome}</li>`);
                            });
                            $listaSugestoes.show();
                        } else {
                            $listaSugestoes.hide();
                        }
                    },
                    error: function () {
                        console.error("Erro ao buscar dados na API.");
                    }
                });
            });

            $listaSugestoes.on('click', '.list-group-item', function () {
                const nomeSelecionado = $(this).text();
                $campoEntrada.val(nomeSelecionado);
                $butao.val($(this).data('id'));
                $listaSugestoes.hide();
            });

            $(document).on('click', function (e) {
                if (!$(e.target).closest(`#${entradaId}`).length && !$(e.target).closest(`#${sugestoesId}`).length) {
                    $listaSugestoes.hide();
                }
            });
        }

        configurarBusca('button-procurar-cliente','client-search-input', 'client-suggestions', 'api/clientes');
        configurarBusca('button-inserir-produto','product-search-input', 'product-suggestions', 'api/produtos');
    });
</script>


{% endblock %}
